_id: EMcVphS3WmIn5MFX
_key: '!macros!EMcVphS3WmIn5MFX'
_stats:
  coreVersion: '13.351'
author: N8Qq94zyfscJUwL4
command: |-
  // Size Change Amplification - Updates size changes in buffs based on any augmentBonus
  const augmentBonus = Number(item.dFlags?.augmentBonus) || 0;
  if (augmentBonus < 0) return; // Bad bonus, bail out
  const sizeBonus = 1 + augmentBonus;
  
  const changes = item.system.changes || [];
  const sizeChange = changes.find(c => c.target === 'size' && c.type === 'untyped');
  
  if (sizeChange) {
    const isNegative = sizeChange.formula.startsWith('-');
    const baseValue = isNegative ? -1 : 1;
    
    const index = changes.indexOf(sizeChange);
    
    const updates = {
      [`system.changes.${index}.formula`]: String(baseValue * sizeBonus)
    };
  
    await buff.update(updates);
  }
folder: sPlaP29TJOPP21oo
img: icons/magic/unholy/strike-body-life-soul-purple.webp
name: Size Change Amplification
scope: global
type: script
